<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lost in Temple City</title>
  <style>
    :root{--bg:#0f1020;--fg:#f5f7ff;--accent:#8b5cf6;--good:#22c55e;--bad:#ef4444;--panel:#1b1d36}
    *{box-sizing:border-box} html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial}
    body{background:radial-gradient(1200px 800px at 70% 10%,#1c1f3b 0%,#0f1020 60%);color:var(--fg);display:flex;align-items:center;justify-content:center}
    .wrap{width:min(1000px,100%);padding:16px}
    .card{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(6px);border-radius:18px;padding:14px;box-shadow:0 20px 40px rgba(0,0,0,.35)}
    h1{margin:0 0 6px;font-size:22px;letter-spacing:.4px}
    p{margin:6px 0 12px;opacity:.9}
    .hud{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .badge{background:var(--panel);border:1px solid rgba(255,255,255,0.08);padding:6px 10px;border-radius:999px;font-weight:600;font-size:13px}
    .accent{color:var(--accent)}
    canvas{display:block;width:100%;height:auto;border-radius:14px;border:1px solid rgba(255,255,255,0.06);background:#0b0c1a}
    .btn{cursor:pointer;background:linear-gradient(135deg,var(--accent),#6d28d9);border:none;color:white;padding:10px 14px;border-radius:12px;font-weight:700;letter-spacing:.3px}
    .btn:active{transform:translateY(1px)}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:10px}
    .small{opacity:.8;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div>
          <h1>Lost in <span class="accent">Temple City</span></h1>
          <p>Play as <b>Patan Raaz</b>, a comedic civilian on a quest to collect <b>5 khaja tokens</b> before curfew. Avoid grumpy guards, grab lassi boosts, and make it to the <b>Temple Gate</b> in time!</p>
        </div>
        <div class="hud">
          <span class="badge" id="scoreBad">Score: 0/5</span>
          <span class="badge" id="timeBad">Time: 60</span>
          <span class="badge">Move: WASD / ⬅️⬆️➡️⬇️ • Sprint: Shift</span>
          <button class="btn" id="restartBtn">Restart</button>
        </div>
      </div>
      <canvas id="game" width="960" height="540" aria-label="Temple City"></canvas>
      <p class="small">Tip: Collide with a lassi for a short speed boost. Collect all tokens, then reach the glowing Gate!</p>
    </div>
  </div>

  <script>
  // --- Simple HTML5 Canvas game — single file ---
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const uiScore = document.getElementById('scoreBad');
  const uiTime = document.getElementById('timeBad');
  const restartBtn = document.getElementById('restartBtn');

  const WORLD = { w: 2000, h: 1200 };
  const view = { x:0, y:0, w: canvas.width, h: canvas.height };

  const rand = (a,b)=> a + Math.random()*(b-a);

  // Input
  const keys = new Set();
  window.addEventListener('keydown', e=>{ keys.add(e.key.toLowerCase()); });
  window.addEventListener('keyup', e=>{ keys.delete(e.key.toLowerCase()); });

  // Entities
  function rect(x,y,w,h){ return {x,y,w,h}; }
  function overlaps(a,b){ return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y; }

  const state = {
    running: true,
    time: 60,
    t: 0,
    msgTimer: 0,
    msg: '',
    collected: 0,
    player: { x: 200, y: 200, w: 28, h: 32, vx:0, vy:0, speed: 180, boost:0, face: 'right', hp:3 },
    walls: [],
    tokens: [], // khaja tokens
    boosts: [], // lassi
    enemies: [], // guards
    gate: rect(WORLD.w-160, WORLD.h-220, 120, 120)
  };

  function seedWorld(){
    // Walls (simple blocks like streets and temple compounds)
    state.walls = [];
    const addWall = (x,y,w,h)=>state.walls.push(rect(x,y,w,h));
    // Border
    addWall(-40, -40, WORLD.w+80, 40);
    addWall(-40, WORLD.h, WORLD.w+80, 40);
    addWall(-40, 0, 40, WORLD.h);
    addWall(WORLD.w, 0, 40, WORLD.h);

    // City blocks
    for(let i=0;i<12;i++){
      const x = rand(100, WORLD.w-300);
      const y = rand(100, WORLD.h-300);
      const w = rand(120, 280);
      const h = rand(90, 260);
      state.walls.push(rect(x,y,w,h));
    }

    // Tokens
    state.tokens = [];
    for(let i=0;i<5;i++){
      state.tokens.push({x: rand(60, WORLD.w-60), y: rand(60, WORLD.h-60), w:18, h:18, spin: Math.random()*Math.PI*2});
    }

    // Boosts
    state.boosts = [];
    for(let i=0;i<3;i++){
      state.boosts.push({x: rand(60, WORLD.w-60), y: rand(60, WORLD.h-60), w:16, h:22, t: Math.random()*6});
    }

    // Enemies (patrolling guards)
    state.enemies = [];
    for(let i=0;i<4;i++){
      const e = { x: rand(150, WORLD.w-150), y: rand(150, WORLD.h-150), w:26, h:30, dir: Math.random()<.5?1:-1, speed: 90, t: Math.random()*6 };
      state.enemies.push(e);
    }
  }

  function reset(){
    state.running = true;
    state.time = 60;
    state.t = 0;
    state.msgTimer = 0;
    state.msg = '';
    state.collected = 0;
    state.player.x = 200; state.player.y=200; state.player.vx=0; state.player.vy=0; state.player.boost=0; state.player.hp=3;
    seedWorld();
    speak("Patan: Temple City, I'm back! Khaja first, heroics later.");
  }

  function speak(m){ state.msg = m; state.msgTimer = 2.6; }

  // Physics helpers
  function moveWithCollisions(ent, dx, dy){
    ent.x += dx;
    for(const w of state.walls){ if(overlaps(ent,w)){ if(dx>0) ent.x = w.x - ent.w; else if(dx<0) ent.x = w.x + w.w; }}
    ent.y += dy;
    for(const w of state.walls){ if(overlaps(ent,w)){ if(dy>0) ent.y = w.y - ent.h; else if(dy<0) ent.y = w.y + w.w ? w.y + w.h : ent.y; }}
  }

  // Camera follow
  function updateView(){
    view.x = Math.max(0, Math.min(WORLD.w - view.w, state.player.x + state.player.w/2 - view.w/2));
    view.y = Math.max(0, Math.min(WORLD.h - view.h, state.player.y + state.player.h/2 - view.h/2));
  }

  // Update loop
  let last = performance.now();
  function loop(now){
    const dt = Math.min(0.033, (now-last)/1000); last = now;
    if(state.running){
      state.t += dt; state.msgTimer = Math.max(0, state.msgTimer - dt);
      // countdown
      state.time -= dt;
      if(state.time <= 0){ state.time = 0; gameOver(false, 'Curfew bell rings! Patan runs home.'); }

      // player input
      const p = state.player;
      let ax = 0, ay = 0;
      if(keys.has('arrowleft')||keys.has('a')) ax -= 1;
      if(keys.has('arrowright')||keys.has('d')) ax += 1;
      if(keys.has('arrowup')||keys.has('w')) ay -= 1;
      if(keys.has('arrowdown')||keys.has('s')) ay += 1;
      const mag = Math.hypot(ax,ay)||1;
      const sprint = keys.has('shift');
      const base = p.speed * (sprint?1.25:1.0) * (p.boost>0?1.5:1.0);
      p.vx = (ax/mag) * base; p.vy = (ay/mag) * base;
      if(ax>0) p.face = 'right'; if(ax<0) p.face = 'left';
      moveWithCollisions(p, p.vx*dt, 0); moveWithCollisions(p, 0, p.vy*dt);
      if(p.boost>0) p.boost -= dt;

      // enemies patrol
      for(const e of state.enemies){
        e.t += dt;
        const dx = Math.cos(e.t)*e.speed*e.dir*dt;
        const dy = Math.sin(e.t*0.8)*e.speed*dt*0.5;
        moveWithCollisions(e, dx, dy);
        if(overlaps(p,e)) gotHit();
      }

      // collect tokens
      for(let i=state.tokens.length-1;i>=0;i--){
        const t = state.tokens[i]; t.spin += dt*4;
        if(overlaps(p,t)){
          state.tokens.splice(i,1); state.collected++;
          speak(["Token get! Khaja secured.","Another snack for science!","Patan: I deserve a raise.","Collector mode: ON."][Math.floor(Math.random()*4)]);
          if(state.collected>=5){ speak("All tokens! To the Gate, hero."); }
        }
      }

      // boosts
      for(let i=state.boosts.length-1;i>=0;i--){
        const b = state.boosts[i]; b.t += dt;
        if(overlaps(p,b)){
          p.boost = 4; state.boosts.splice(i,1); speak("Lassi boost! Gears = engaged.");
        }
      }

      // win check
      if(state.collected>=5 && overlaps(p, state.gate)){
        gameOver(true, 'You reached the Temple Gate with snacks to spare!');
      }

      updateView();
      uiScore.textContent = `Score: ${state.collected}/5`;
      uiTime.textContent = `Time: ${Math.ceil(state.time)}`;
    }

    draw();
    requestAnimationFrame(loop);
  }

  function gotHit(){
    const p = state.player; p.hp--; speak(["Guard: No loitering!","Patan: That hurt my ego.","Oops, ankle."][Math.floor(Math.random()*3)]);
    p.x += (Math.random()>.5?1:-1)*20; p.y += (Math.random()>.5?1:-1)*20;
    if(p.hp<=0){ gameOver(false, 'The guards escorted Patan out.'); }
  }

  function gameOver(win, line){
    state.running = false; speak(line);
    setTimeout(()=>{
      overlay = { show:true, win };
    }, 50);
  }

  // Render
  function draw(){
    // clear
    ctx.fillStyle = '#0b0c1a';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // parallax starry sky
    for(let i=0;i<60;i++){
      const sx = (i*97 % WORLD.w) - view.x*0.3;
      const sy = (i*53 % WORLD.h) - view.y*0.3;
      const x = ((sx % canvas.width)+canvas.width)%canvas.width;
      const y = ((sy % canvas.height)+canvas.height)%canvas.height;
      ctx.globalAlpha = 0.25; ctx.fillStyle = '#b3c8ff';
      ctx.fillRect(x, y, 2, 2); ctx.globalAlpha = 1;
    }

    ctx.save();
    ctx.translate(-view.x, -view.y);

    // ground grid
    drawGrid();

    // walls / buildings
    for(const w of state.walls){ drawBuilding(w); }

    // gate
    drawGate(state.gate);

    // boosts
    for(const b of state.boosts){ drawLassi(b); }

    // tokens
    for(const t of state.tokens){ drawToken(t); }

    // enemies
    for(const e of state.enemies){ drawGuard(e); }

    // player
    drawPlayer(state.player);

    ctx.restore();

    // UI message
    if(state.msgTimer>0){
      ctx.save();
      ctx.font = '16px Inter, system-ui';
      ctx.fillStyle = 'rgba(0,0,0,.6)';
      const pad=8; const textW = ctx.measureText(state.msg).width + pad*2;
      ctx.fillRect((canvas.width-textW)/2, 16, textW, 34);
      ctx.fillStyle = '#fff';
      ctx.fillText(state.msg, (canvas.width-textW)/2+pad, 38);
      ctx.restore();
    }

    // overlay end screen
    if(overlay.show){
      ctx.save();
      ctx.fillStyle = 'rgba(10,12,24,0.75)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.translate(canvas.width/2, canvas.height/2);
      ctx.textAlign = 'center';
      ctx.font = '28px Inter, system-ui';
      ctx.fillStyle = overlay.win ? '#22c55e' : '#ef4444';
      ctx.fillText(overlay.win?'Victory!':'Game Over', 0, -10);
      ctx.font = '16px Inter, system-ui';
      ctx.fillStyle = '#fff';
      ctx.fillText(state.msg, 0, 20);
      ctx.fillText('Press R to Restart', 0, 50);
      ctx.restore();
    }
  }

  function drawGrid(){
    const tile=60; ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.lineWidth=1;
    const x0 = Math.floor(view.x/tile)*tile; const y0 = Math.floor(view.y/tile)*tile;
    for(let x=x0; x<view.x+view.w; x+=tile){ ctx.beginPath(); ctx.moveTo(x, view.y); ctx.lineTo(x, view.y+view.h); ctx.stroke(); }
    for(let y=y0; y<view.y+view.h; y+=tile){ ctx.beginPath(); ctx.moveTo(view.x, y); ctx.lineTo(view.x+view.w, y); ctx.stroke(); }
  }

  function drawBuilding(w){
    ctx.fillStyle = '#1b1d36';
    ctx.fillRect(w.x,w.y,w.w,w.h);
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.strokeRect(w.x+1,w.y+1,w.w-2,w.h-2);
  }

  function drawPlayer(p){
    // body
    ctx.fillStyle = '#8b5cf6';
    ctx.fillRect(p.x, p.y, p.w, p.h);
    // face
    ctx.fillStyle = '#f4d7bd';
    ctx.fillRect(p.x+6, p.y-6, 16, 10);
    // smile
    ctx.fillStyle = '#000'; ctx.fillRect(p.x+10, p.y-1, 8, 2);
    // direction hat
    if(p.face==='right'){ ctx.fillStyle='#a78bfa'; ctx.fillRect(p.x+p.w-6,p.y+6,6,6); }
    else { ctx.fillStyle='#a78bfa'; ctx.fillRect(p.x,p.y+6,6,6); }
  }

  function drawGuard(e){
    ctx.fillStyle = '#ef4444';
    ctx.fillRect(e.x, e.y, e.w, e.h);
    ctx.fillStyle = '#000'; ctx.fillRect(e.x+4, e.y-6, 18, 6);
  }

  function drawToken(t){
    const r = 10 + Math.sin(t.spin)*2;
    ctx.save(); ctx.translate(t.x+t.w/2, t.y+t.h/2); ctx.rotate(t.spin*0.25);
    ctx.fillStyle = '#22c55e';
    ctx.beginPath(); ctx.moveTo(-r,0); ctx.lineTo(0,-r); ctx.lineTo(r,0); ctx.lineTo(0,r); ctx.closePath(); ctx.fill();
    ctx.restore();
  }

  function drawLassi(b){
    ctx.fillStyle = '#fde68a';
    ctx.fillRect(b.x, b.y, b.w, b.h);
    ctx.fillStyle = '#8b5cf6';
    ctx.fillRect(b.x, b.y, b.w, 4);
  }

  function drawGate(g){
    const glow = 6 + Math.sin(state.t*4)*4;
    ctx.fillStyle = '#0e7490'; ctx.fillRect(g.x, g.y, g.w, g.h);
    ctx.strokeStyle = `rgba(139,92,246,0.8)`; ctx.lineWidth = glow; ctx.strokeRect(g.x+glow/2, g.y+glow/2, g.w-glow, g.h-glow);
  }

  // Overlay
  let overlay = { show:false, win:false };

  // Restart mechanics
  window.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase()==='r'){ overlay.show=false; reset(); }
  });
  restartBtn.addEventListener('click', ()=>{ overlay.show=false; reset(); });

  // Kickoff
  reset();
  requestAnimationFrame(loop);
  </script>
</body>
</html>
